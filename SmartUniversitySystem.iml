import java.util.Scanner;

public class SmartUniversitySystem {
    
    private static StudentDatabase studentDB = new StudentDatabase();
    private static AppointmentQueue appointments = new AppointmentQueue();
    private static EmergencyIssues issues = new EmergencyIssues();
    private static ActionHistory history = new ActionHistory();
    private static Scanner scanner = new Scanner(System.in);

    public static void main(String[] args) {
        // ðŸš€ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…
        studentDB.addStudents();
        studentDB.removeLowGPA();
        studentDB.insertAtIndex2();
        
        appointments.addNormalAppointments();
        appointments.addUrgentAtBeginning();
        appointments.cancelLast();
        
        issues.addIssues();
        
        history.addInitialActions();
        history.undoLastAction();
        history.addNewAction("Requested Transcript");

        // ðŸŽ›ï¸ ÐœÐµÐ½ÑŽ
        boolean running = true;
        while (running) {
            showMenu();
            int choice = getChoice();
            
            switch (choice) {
                case 1 -> showStudents();
                case 2 -> showAppointments();
                case 3 -> showEmergencyIssues();
                case 4 -> showActionHistory();
                case 5 -> addNewIssue();
                case 6 -> undoAction();
                case 7 -> {
                    System.out.println("ðŸ‘‹ Ð”Ð¾ ÑÐ²Ð¸Ð´Ð°Ð½Ð¸Ñ! Ð£Ð´Ð°Ñ‡Ð¸ Ð² ÑƒÑ‡Ñ‘Ð±Ðµ!");
                    running = false;
                }
                default -> System.out.println("âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.");
            }
            System.out.println("\n" + "=".repeat(50) + "\n");
        }
    }

    private static void showMenu() {
        System.out.println("ðŸŽ“ SMART UNIVERSITY SERVICE SYSTEM");
        System.out.println("1. ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚Ð¾Ð²");
        System.out.println("2. ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÐ¸");
        System.out.println("3. ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹");
        System.out.println("4. ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹");
        System.out.println("5. Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ");
        System.out.println("6. ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ");
        System.out.println("7. Ð’Ñ‹Ñ…Ð¾Ð´");
        System.out.print("\nÐ’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð¿Ñ†Ð¸ÑŽ (1-7): ");
    }

    private static int getChoice() {
        try {
            return Integer.parseInt(scanner.nextLine());
        } catch (NumberFormatException e) {
            return -1;
        }
    }

    private static void showStudents() {
        System.out.println("\nðŸ‘¥ Ð¡Ñ‚ÑƒÐ´ÐµÐ½Ñ‚Ñ‹ Ñ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¼ GPA:");
        studentDB.printAllWithIterator();
        Student top = studentDB.findTopStudent();
        if (top != null) {
            System.out.println("\nðŸ† Ð›ÑƒÑ‡ÑˆÐ¸Ð¹ ÑÑ‚ÑƒÐ´ÐµÐ½Ñ‚: " + top);
        }
    }

    private static void showAppointments() {
        System.out.println("\nðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ¸ Ð½Ð° ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸Ð¸:");
        appointments.showFirstAndLast();
        appointments.printWithIterator();
    }

    private static void showEmergencyIssues() {
        System.out.println("\nðŸš¨ Ð¡Ñ€Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹:");
        issues.showMostUrgent();
        issues.printInPriorityOrder();
    }

    private static void showActionHistory() {
        System.out.println("\nðŸ”„ Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹:");
        history.showFirstAndLast();
        history.printHistoryWithIterator();
    }

    private static void addNewIssue() {
        System.out.print("\nÐ’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹: ");
        String desc = scanner.nextLine();
        System.out.print("Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ ÑÑ€Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸ (1-5, Ð³Ð´Ðµ 1 = ÑÐ°Ð¼Ñ‹Ð¹ ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ð¹): ");
        try {
            int level = Integer.parseInt(scanner.nextLine());
            if (level >= 1 && level <= 5) {
                issues.getIssues().add(new Issue(desc, level));
                System.out.println("âœ… ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð°!");
            } else {
                System.out.println("âŒ Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ 1 Ð´Ð¾ 5");
            }
        } catch (NumberFormatException e) {
            System.out.println("âŒ Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‡Ð¸ÑÐ»Ð¾!");
        }
    }

    private static void undoAction() {
        System.out.println("\nâ†©ï¸ ÐžÑ‚Ð¼ÐµÐ½Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ...");
        history.undoLastAction();
    }
}
